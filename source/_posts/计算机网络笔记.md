---
title: 计算机网络笔记
tags:
  - computer network
categories:
  - four fundamental computer technology
abbrlink: db0b4310
date: 2022-06-30 22:05:21
mathjax: true
---

{% label primary@声明：%}
以下笔记内容摘自计算机网络第八版 谢希仁 编著

<!-- more -->

## **概述**
---
网络类型：
电信网络/有线电视网络/计算机网络

网络 -- 计算机网络简称
- 由若干节点（计算机/集线器/交换机/路由器等）和连接这些节点的链路组成。

互连网
- 是一个通用名词，它泛指由多个计算机网络互连而成的计算机网络。

互联网
- 是一个专有名词，它指当前全球最大的/开放的/由众多网络相互连接而成的特定互连网，它采用TCP/IP协议族作为通信的规则，且其前身是美国的ARPANET。

ISP - Internet Service Provider -- 互联网服务提供者

互联网组成：
- 边缘部分 - 用户直接使用
- 核心部分 - 为边缘部分提供服务的（提供连通性和交换）

1. 边缘部分：
端系统之间的通信方式：
- 客户-服务器方式
- 对等连接方式P2P

2.核心部分：
- 电路交换
  - 整个报文的比特流连续地从源点直达终点，好像在一个管道中传送
- 分组交换
  - 整个报文先传送到相邻节点，全部存储下来后查找转发表，转发到下一个节点
- 报文交换
  - 单个分组（整个报文的一部分）传送到相邻节点，存储下来后查找转发表，转发到下一个节点

计算机网络分类：
1.按照网络的作用范围进行分类：
- 广域网WAN - Wide Area Network
- 城域网MAN - Metropolitan Area Network
- 局域网LAN - Local Area Network
- 个人区域网PAN - Personal Area Network

2.按照网络的使用者进行分类
- 公用网 - public network
- 专用网 - private network

3.用来把用户接入到互联网的网络
- 接入网AN - Access Network -- 本地接入网或居民接入网

计算机网络的性能

性能指标：
- 速率
- 带宽
- 吞吐量
- 时延
  - 发送时延
  - 传播时延
  - 处理时延
  - 排队时延
- 时延带宽积
- 往返时间RTT
- 利用率

非性能指标：
- 费用
- 质量
- 标准化
- 可靠性
- 可扩展性和可升级性
- 易于管理和维护

网络协议简称协议，主要由以下三个要素组成：
- 语法
  - 数据与控制信息的结构或格式
- 语义
  - 需要发出何种控制信息，完成何种动作以及做出何种响应
- 同步
  - 事件实现顺序的详细说明

五层协议体系结构：
- 应用层
- 运输层
- 网络层
- 数据链路层
- 物理层

实体 - 任何可以发送或接收信息的硬件或软件进程
协议 - 控制两个对等实体或多个实体进行通信的规则的集合
服务访问点 - 在同一系统中相邻两层的实体进行交互（即交换信息）的地方


## **物理层**
---
物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。

### 物理层基本概念

物理层与传输媒体接口相关的四特性：
- 机械特性
  - 接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置等
- 电气特性
  - 指明在接口电缆的各条线上出现的电压的范围
- 功能特性
  - 指明某条线上出现的某一电平的电压的意义
- 过程特性
  - 指明对于不同功能的各种可能事件的出现顺序

### 数据通信的基础知识

数据通信系统可划分为三个部分：即源系统、传输系统、目的系统

源系统：
- 源点
  - 源点设备产生要传输的数据
- 发送器
  - 数字比特流通过发送器编码后才能在传输系统中进行传输
  - 典型的发送器就是调制器

目的系统：
- 接收器
  - 将传输过来的信号转换为目的设备能处理的信息
  - 典型的接收器就是解调器
- 终点
  - 终点设备从接收器获取传送过来的数字比特流，然后把信息输出。

消息：话音、文字、图像、视频等
数据：运送消息的实体
信道：一般表示向某一方向传送信息的媒体

通信双方交互方式分为三种：
- 单向通信或称单工通信
- 双向交替通信或称半双工通信
- 双向同时通信或称全双工通信

常用编码方式：
- 不归零制：正电平代表1，负电平代表0
- 归零制：正脉冲代表1，负脉冲代表0
- 曼彻斯特编码：位周期中心向上跳变代表0，位周期中心向下跳变代表1.但也可反过来定义。
- 差分曼彻斯特编码：每一位的中心处始终都有跳变。位开始边界有跳变代表0，位开始边界没有跳变代表1.

基本的带通调制方法：
- 调幅AM
- 调频FM
- 调相PM

奈氏准则：
- 在带宽为*W*(Hz)的低通信道中，若不考虑噪声影响，则码元传输的最高速率是2*W*(码元/秒)
香农公式：
- 信道的带宽或者信道中的信噪比越大，信道的极限传输速率就越高

### 物理层下面的传输媒体

传输媒体：
- 引导型传输媒体
- 非引导型传输媒体

引导型传输媒体：
- 双绞线
  - 无屏蔽双绞线UTP(Unshielded Twisted Pair)
  - 屏蔽双绞线STP(Shielded Twisted Pair)
- 同轴电缆
  - 铜质芯线、绝缘层、网状编织外导体屏蔽层、绝缘保护套层组成
- 光缆

非导引型传输媒体：
- 微波接力通信
- 卫星通信

### 信道复用技术

1.频分复用FDM(Frequency Division Multiplexing)
- 频分复用的各路信号在同样时间占用不同的带宽资源

2.时分复用TDM(Time Division Multiplexing)
- 时分复用的所有用户是在不同的时间占用同样的频带宽度

3.波分复用WDM(Wavelength Division Multiplexing)
- 光的频分复用

4.码分复用CDM(Code Division Multiplexing)

### 宽带接入技术

1.ADSL(Asymmetric Digital Subscriber Line)技术
- 用数字技术对现有模拟电话的用户线进行改造

2.光纤同轴混合网HFC(Hybrid Fiber Coax)

3.FTTx技术


## **数据链路层**
---
数据链路层信道：
- 点对点信道
- 广播信道

### 数据链路层的几个共同问题

数据链路：在一条物理线路之上，通过一些规程或协议来控制这些数据的传输，以保证被传输数据的正确性；实现这些规程或协议的硬件和软件加到物理线路，这样就构成了数据链路。
帧：数据链路层的协议数据单元

三个基本问题：
- 封装成帧
- 透明传输
- 差错检测

### 点对点协议PPP

PPP - Point-to-Point Protocol

PPP协议组成：
- 一个将IP数据报封装到串行链路的方法
- 一个用来建立、配置和测试数据链路连接的链路控制协议LCP - Link Control Protocol
- 一套网络控制协议NCP - Network Control Protocol

### 使用广播信道的数据链路层

共享信道方法：
- 静态划分信道
  - 频分复用、时分复用、波分复用、码分复用
- 动态媒体接入控制
  - 随机接入
  - 受控接入

数据链路层拆分：
- 逻辑链路控制LLC - Logical Link Control
- 媒体接入控制MAC - Medium Access Control

CSMA/CD协议：载波监听多点接入/碰撞检测
- Carrier Sense Multiple Access with Collision Detection
- 多点接入：总线型网络，许多计算机以多点接入方式连接在一根总线上
- 载波监听：不管在想要发送数据之前，还是在发送数据之中，每个站都必须不停地检测信道
- 碰撞检测：适配器边发送数据边检测信道上的信号电压变化情况

使用集线器的星形拓扑
集线器的一些特点：
- 使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，使用的还是CSMA/CD协议
- 一个集线器有许多端口
- 集线器工作在物理层，每个端口负责转发比特，不进行碰撞检测
- 集线器采用了专门芯片，进行自适应串音回波抵消

以太网信道利用率：
参数α定义为以太网单程端到端时延τ与帧的发送时间T0之比：$\alpha=\frac{\tau}{T_0}$
极限信道利用率Smax为：
$$S_{max}=\frac{T_0}{T_0+\tau}=\frac{1}{1+\alpha}$$

只有当参数α远小于1才能得到尽可能高的极限信道利用率


MAC层的硬件地址，硬件地址又称物理地址或MAC地址

### 扩展的以太网

1.在物理层扩展以太网 - 集线器
2.在数据链路层扩展以太网 - 交换机
3.虚拟局域网 - VLAN(Virtual LAN)
  - 局域网给用户提供的一种服务，并不是一种新型的局域网

### 高速以太网
- 100BASE-T 以太网
- 吉比特以太网
- 10吉比特以太网和更快的以太网
- 使用以太网进行宽带接入 - PPPoE(PPP over Ethernet)


## **网络层**
---

### 网络层的几个重要概念

网络层提供的两种服务：
1.虚电路服务
2.数据报服务

网络层的两个层面：
1.数据层面
2.控制层面

### 网际协议IP

IP地址及其表示方法
使用点分十进制记法可以提高可读性
IP地址 ::= {<网络号>, <主机号>}

分类的IP地址

![分类IP地址](\../images/分类IP地址.svg)

无分类编址CIDR
CIDR - Classless Inter-Domain Routing -- 无分类域间路由选择
IP地址 ::= {<网络前缀>, <主机号>}
使用斜线记法，或称CIDR记法
地址掩码或称掩码，又称子网掩码
路由聚合
网络前缀越短的地址块所包含的地址数就越多

地址解析协议ARP

IP数据包的格式：
1. 版本
2. 首部长度
3. 区分服务
4. 总长度
5. 标识
6. 标志
7. 片偏移
8. 生存时间
9. 协议
10. 首部检验和
11. 源地址
12. 目的地址
13. 可选字段
14. 填充
15. 数据部分

### IP层转发分组的过程

1.基于终点的转发
2.最长前缀匹配
3.使用二叉线索查找转发表

### 网际控制报文协议ICMP

ICMP - Internet Control Message Protocol

ICMP报文种类：
- ICMP差错报告报文
  - 终点不可达
  - 时间超过
  - 参数问题
  - 改变路由
- ICMP询问报文
  - 回送请求或回送回答
  - 时间戳请求或时间戳回答

### IPv6

IPv6的基本首部：
1. 版本
2. 通信量类
3. 流标号
4. 有效载荷长度
5. 下一个首部
6. 跳数限制
7. 源地址
8. 目的地址

IPv6地址
在IPv6中，每个地址占128位，地址空间大于3.4*10^38.
IPv6使用冒号十六进制记法
零压缩：一连串连续的零可以为一对冒号所取代

从IPv4向IPv6过渡
1. 双协议栈
2. 隧道技术

ICMPv6

### 互联网的路由选择协议

几个基本概念
1.理想的路由算法
- 算法必须是正确和完整的
- 算法在计算上应简单
- 算法应能适应通信量和网络拓扑的变化
- 算法应具有稳定性
- 算法应是公平的
- 算法应是最佳的

2.分层次的路由选择协议
自治系统 -- AS - autonomous system
域间路由选择：自治系统之间的路由选择
域内路由选择：自治系统内部的路由选择
路由选择策略：
- 内部网关协议IGP
  - RIP
  - OSPF
- 外部网关协议EGP

**内部网关协议RIP**
RIP - Routing Information Protocol
- 一种分布式的基于距离向量的路由选择协议
  
协议RIP特点：
- 仅和相邻路由器交换信息
- 交换当前路由表
- 按固定的时间间隔交换路由信息

坏消息传播得慢：当网络出现故障时，要经过比较长的时间才能将此信息传送到所有路由器
协议RIP优点：实现简单，开销较小

**内部网关协议OSPF**
OSPF - Open Shortest Path First -- 开放最短路径优先
- 使用链路状态协议(link state protocol)

协议OSPF特点：
- 向本自治系统中所有路由器发送信息（洪泛法）
- 发送信息是与本路由器相邻的所有路由器的链路状态
- 链路状态变化或每隔一段时间，路由器向所有路由器用洪泛法发送链路状态信息

OSPF五种分组类型：
- 问候分组
- 数据库描述分组
- 链路状态请求分组
- 链路状态更新分组
- 链路状态确认分组

**外部网关协议BGP**
BGP-4：使用路径向量路由选择协议
两点原因：
- 互联网的规模太大，使得自治系统AS之间路由选择非常困难
- 自治系统AS之间的路由选择必须考虑有关策略

三种不同自治系统AS:
- 末梢AS
- 穿越AS
- 对等AS

BGP路由选择：
- 本地偏好
- AS跳数最少
- 热土豆路由选择算法
- BGP标识符数值最小的路由

BGP四种报文：
- 打开报文
- 更新报文
- 保活报文
- 通知报文

路由器的构成
1.路由器的结构：
- 路由选择部分
  - 路由选择处理机
- 分组转发部分
  - 交换结构
  - 输入端口
  - 输出端口

2.交换结构：
三种交换方法：
- 通过存储器
- 通过总线
- 通过互连网络

### IP多播

网际组管理协议IGMP - Internet Group Management Protocol

多播路由选择协议
转发多播数据报使用的三种方法：
- 洪泛与剪除
- 隧道技术
- 基于核心的发现技术

### 虚拟专用网VPN & 网络地址转换NAT

### 多协议标签交换MPLS

MPLS - MultiProtocol Label Switching

MPLS没有取代IP，作为一种IP增强技术
MPLS三个特点：
- 支持面向连接的服务质量
- 支持流量工程，均衡网络负载
- 有效地支持虚拟专用网VPN

转发等价类FEC - Forwarding Equivalence Class

MPLS首部格式：
- 标签值
- 试验
- S（栈）
- 生存时间TTL

### 软件定义网络SDN


## **运输层**
---

### 运输层协议概述

运输层提供应用进程间的逻辑通信
网络层为主机之间的通信提供服务，而运输层则在网络层的基础上，为应用进程之间的通信提供服务。
运输层两个主要协议：
- 用户数据报协议UDP(User Datagram Protocol)
- 传输控制协议TCP(Transmission Control Protocol)

在协议栈层间的抽象的协议端口是软件端口，软件端口是应用层的各种协议进程与运输实体进行层间交互的地点。
端口号只具有本地意义，它标志本计算机应用层中的各个进程在和运输层交互时的层间接口。
运输层的端口号分为两大类：
- 服务器使用的端口号
  - 熟知端口号或全球通用端口号，数值为0~1023
  - 登记端口号，数值为1024~49151
- 客户端使用的端口号
  - 客户进程运行时动态选择，即短暂端口号，数值为49152~65535

### 用户数据报协议UDP

UDP只在IP的数据报服务之上增加了很少一点功能，这就是复用和分用的功能以及差错检测的功能。
UDP特点：
- UDP是无连接的
- UDP尽最大努力交付
- UDP是面向报文的
- UDP没有拥塞控制
- UDP支持一对一、一对多、多对一和多对多的交互通信
- UDP的首部开销小

UDP首部格式：
- 源端口
- 目的端口
- 长度
- 检验和

### 传输控制协议TCP概述

TCP特点：
- TCP是面向连接的运输层协议
- TCP连接是点对点通信
- TCP提供可靠交付服务
- TCP提供全双工通信
- TCP是面向字节流的

TCP连接的端点叫作套接字或插口
> 套接字socket = (IP地址：端口号)


每一条TCP连接唯一地被通信两端的两个端点所确定，即：
> TCP连接 ::= {socket1, socket2} = {(IP1:port1), (IP2:port2)}


### 可靠传输的工作原理

1. 停止等待协议
2. 连续ARQ协议
3. 滑动窗口协议

### TCP报文段首部格式

首部固定部分各字段：
- 源端口和目的端口
- 序号
- 确认号
- 数据偏移
- 保留
- 紧急URG
- 确认ACK
- 推送PUSH
- 复位RST
- 同步SYN
- 终止FIN
- 窗口
- 检验和
- 紧急指针
- 选项

### TCP可靠传输的实现

1. 以字节为单位的滑动窗口
2. 超时重传时间的选择
3. 选择确认SACK

### TCP流量控制

流量控制：让发送方的发送速率不要太快，要让接收方来得及接收。
发送方的发送窗口不能超过接收方给出的接收窗口的数值。

### TCP拥塞控制

拥塞：在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。
拥塞控制：防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不至于过载。
TCP拥塞控制算法四种：
- 慢开始
- 拥塞避免
- 快重传
- 快恢复

主动队列管理AQM

### TCP运输连接管理

运输连接三个阶段：
- 连接建立
- 数据传送
- 连接释放

TCP的连接建立

![三报文握手](\../images/三报文握手.png)

Q:为什么A最后还要发送一次确认呢？
A:这主要是为了防止已失效的连接请求报文段突然又传送到了B，因而产生错误。

TCP的连接释放

![四报文挥手](\../images/四报文挥手.jpg)

Q:为什么A在TIME-WAIT状态必须等待2MSL的时间呢？
A:1.为了保证A发送的最后一个ACK报文能够到达B;
  2.防止“已失效的连接请求报文段”出现在本连接中。

TCP的有限状态机

![四报文挥手](\../images/tcp有限状态机.jpg)